
sudo: required

cache:
  ccache: true


jobs:
  include:
    - name: "Linux AMD64 Build"
      arch: amd64
      os: linux
      dist: bionic
      group: travis_latest
      language: python
      python: "3.6"
      addons:
        apt:
          packages:
          - libblas-dev
          - liblapack-dev
          - bc
      script:
        - cd "${TRAVIS_BUILD_DIR}"/tests
        - pip install jinja2
        - python tester.py testset_travis_blasfeo_double_amd64.json
        - python tester.py testset_travis_blas_double_amd64.json
        - python tester.py testset_travis_blas_single_amd64.json

    - name: "Linux ARM64 Build"
      arch: arm64
      os: linux
      dist: bionic
      group: travis_latest
      language: python
      python: "3.6"
      addons:
        apt:
          packages:
          - libblas-dev
          - liblapack-dev
          - bc
      script:
        - cd "${TRAVIS_BUILD_DIR}"/tests
        - pip install jinja2
        - python tester.py testset_travis_blasfeo_double_arm64.json
        - python tester.py testset_travis_blas_double_arm64.json
        - python tester.py testset_travis_blas_single_arm64.json

    - name: "Linux AMD64 cmake Build"
      arch: amd64
      os: linux
      dist: bionic
      group: travis_latest
      script:
        - mkdir "${TRAVIS_BUILD_DIR}"/build
        - cd "${TRAVIS_BUILD_DIR}"/build
        - cmake ..
        - make
        - ls
        - cd examples
        - ls

    - name: "Windows AMD64 Build"
      if: branch = windows_support
      os: windows
      language: bash
      script:
        - export PATH="/C/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools/MSBuild/15.0/Bin":$PATH
        - mkdir "${TRAVIS_BUILD_DIR}"/build
        - cd "${TRAVIS_BUILD_DIR}"/build
        - cmake -DTARGET=GENERIC ..
        - ls
        - MSBuild.exe blasfeo.vcxproj
        - ls
        - cd examples
        - ls
        - MSBuild.exe getting_started.vcxproj
        - ls

    - name: "MacOS Build"
      if: branch = mac_build
      os: osx
      osx_image: xcode10.2
      language: shell
      script:
        - cd "${TRAVIS_BUILD_DIR}"/tests
        - python3 -m pip install --user jinja2
        - python3 tester.py testset_travis.json

    - name: "Windows Build"
      if: branch = windows_build
      os: windows
      language: shell
      before_install:
        - choco install python --version 3.6
        - python -m pip install --upgrade pip
      env: PATH=/c/Python36:/c/Python36/Scripts:$PATH
      script:
        - cd "${TRAVIS_BUILD_DIR}"/tests
        - pip install --user jinja2
        - python tester.py testset_travis.json


